<html lang="">

	<head>

		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
		<link href="resources/demo.css" rel="stylesheet">

		<script src="resources/demo.js?v=2"></script>
		<script src="resources/html2canvas.min.js?v=2"></script>

		<title>Crag Charts: Column</title>

		<style>

			:root {
				--bg: #FFFFFF;
				--on-bg: #081b33;
			}
			body {
				background-color: var(--bg);
			}
			.chart-container {
				width: 100vw;
				height: 100vh;
				border: none;
				margin: 0;
			}
			.menu-button {
				height: 34px;
				width: 34px;
				margin: 16px;
				filter: invert(0.8);
				cursor: pointer;
				transition: all 0.3s;
				display: inline-block;
			}

			#menu-modal {
				position: fixed;
				color: var(--on-bg);
				background: var(--bg);
				max-height: calc(100vh - 16px);
				max-width: 350px;
				width: calc(100vw - 16px);
				top: 8px;
				left: 8px;
				z-index: 99;
				box-shadow: 0 0 4px 1px rgb(0 0 0 / 40%);
				border-radius: 8px;
				box-sizing: border-box;
				font-family: 'Roboto', sans-serif;
				overflow: hidden;
				opacity: 0.925;
				user-select: none;
			}
			#menu-modal label {
				display: block;
				margin-top: 16px;
				margin-bottom: 4px;
				margin-left: 8px;
				font-size: 11px;
				opacity: 0.6;
			}
			#menu-modal select,
			#menu-modal button,
			#menu-modal input[type="text"] {
				width: calc(100% - 24px);
				padding: 8px;
				margin-bottom: 4px;
				border: 2px solid var(--on-bg);
				background: transparent;
				color: var(--on-bg);
				border-radius: 24px;
				margin-left: 16px;
				cursor: pointer;
			}
			#menu-modal input[type="text"] {
				cursor: text;
			}
			#menu-modal input[type="text"]:focus {
				outline: none;
			}
			#menu-modal button {
				margin-top: 16px;
				border: 2px solid var(--on-bg);
				background: var(--on-bg);
				color: var(--bg);
			}
			#menu-modal option {
				background: var(--bg);
				padding: 8px;
			}
			#menu-button-close {
				height: 16px;
				cursor: pointer;
				filter: invert(0.8);
				margin: 7px 0 7px calc(100% - 26px);
			}
			.full-screen-textbox {
				z-index: 100;
				width: 697px;
				max-width: 500px;
				position: fixed;
				height: 609px;
				max-height: 50vh;
				top: 50vh;
				left: 50vw;
				transform: translate(-50%, -50%);
				border-radius: 8px;
				box-shadow: 0 0 4px 1px rgb(0 0 0 / 30%) ;
				margin: 0;
				padding: 8px;
				background: var(--on-bg);
				color: var(--bg);
				font-family: monospace;
				white-space: pre;
			}
			.overlay {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				background: var(--bg);
				opacity: 0.95;
				z-index: 99;
			}
			.slider-container {
				position: relative;
				height: 36px;
				margin-left: 16px;
				margin-bottom: 4px;
				width: calc(100% - 24px);
			}
			.slider-container span {
				position: absolute;
				top: 50%;
				left: 16px;
				transform: translateY(-50%);
				pointer-events: none;
				font-family: Roboto, sans-serif;
				font-size: 13px;
			}
			.slider-container input[type="range"] {
				margin: 0;
				-webkit-appearance: none;
				position: relative;
				overflow: hidden;
				height: 36px;
				width: 100%;
				cursor: pointer;
				border-radius: 24px;
				border: 2px solid var(--on-bg);
				background: transparent;
			}

			.slider-container ::-webkit-slider-runnable-track {
				background: transparent;
			}

			/*
			 * 1. Set to 0 width and remove border for a slider without a thumb
			 */
			.slider-container ::-webkit-slider-thumb {
				-webkit-appearance: none;
				width: 0;
				height: 40px;
				background: transparent;
				box-shadow: -100vw 0 0 100vw dodgerblue;
			}

			.slider-container ::-moz-range-track {
				height: 40px;
				background: transparent;
			}

			.slider-container ::-moz-range-thumb {
				background: #fff;
				height: 40px;
				width: 0;
				border: 0;
				border-radius: 0 !important;
				box-shadow: -100vw 0 0 100vw dodgerblue;
				box-sizing: border-box;
			}

			.slider-container ::-ms-fill-lower {
				background: var(--bg);
			}

			.slider-container ::-ms-thumb {
				background: transparent;
				border: none;
				height: 40px;
				width: 0;
				box-sizing: border-box;
			}

			.slider-container ::-ms-ticks-after {
				display: none;
			}

			.slider-container ::-ms-ticks-before {
				display: none;
			}

			.slider-container ::-ms-track {
				background: transparent;
				color: transparent;
				height: 40px;
				border: none;
			}

			.slider-container ::-ms-tooltip {
				display: none;
			}

			#data-input-modal {
				position: fixed;
				left: 50vw;
				top: 50vh;
				transform: translate(-50%, -50%);
				max-width: 100vw;
				max-height: 100vh;
				background: var(--bg);
				color: var(--on-bg);
				border-radius: 2px;
				z-index: 101;
				box-shadow: 0 0 6px 2px rgb(0 0 0 / 50%);
				overflow: hidden;
			}

			#data-input-modal table {
				border-collapse: collapse;
			}
			#data-input-modal th {
				background: #666666;
				border: 1px solid var(--on-bg);
				color: var(--on-bg);
				font-weight: 300;
				font-size: 10px;
				padding: 4px 8px;
			}
			#data-input-modal tr td:first-child {
				background: #666666;
				font-size: 10px;
				text-align: center;
				color: var(--on-bg);
				width: 26px;
			}
			#data-input-modal td {
				border: 1px solid var(--on-bg);
			}
			#data-input-modal input,
			#data-input-modal textarea {
				background: transparent;
				color: var(--on-bg);
				padding: 2px 8px;
				height: 26px;
				border: 2px solid transparent;
				resize: none;
			}
			#data-input-modal input:focus,
			#data-input-modal textarea:focus {
				outline: none;
				border: 2px solid blue;
			}
			#canvas-presentation {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				z-index: 200;
				height: 100vh;
				background: var(--on-bg);
			}
			#canvas-presentation canvas {
				border: 4px solid var(--bg);
				width: 95vw !important;
				height: 95vh !important;
				top: 2.5vh;
				left: 2.5vw;
				position: absolute;
				box-shadow: 0 0 8px 3px rgba(0, 0, 0, 0.5);
			}
			#canvas-presentation span {
				position: absolute;
				top: 8px;
				z-index: 1;
				background: var(--bg);
				color: var(--on-bg);
				border-radius: 25px;
				font-size: 14px;
				padding: 4px 16px;
				box-shadow: 0 0 4px 2px rgb(0 0 0 / 30%);
				opacity: 0.7;
				left: 50vw;
				transform: translateX(-50%);
			}
			#canvas-presentation img {
				position: absolute;
				right: 2.5vw;
				margin: 8px;
				z-index: 10;
				top: 2.5vh;
				width: 32px;cursor: pointer;
			}
			@media screen and (prefers-color-scheme: dark) {
				:root {
					--bg: #081b33;
					--on-bg: #FFFFFF;
				}
				.menu-button {
					filter: invert(0);
				}
				#menu-button-close {
					filter: invert(0);
				}
			}
		</style>

	</head>

	<body>

	<img src="/resources/icons/dice.svg" alt="Random Data" class="menu-button" id="new-data" onclick="newData()" style="display: none">

		<div id="menu-modal" style="display: none">

			<div id="menu-modal-head" style="width: 100%; background: rgba(50,50,50,0.2); height: 30px;">
				<img src="/resources/icons/cross.svg" alt="Menu" id="menu-button-close" onclick="hideMenu()">
			</div>

			<div style="overflow: auto; max-height: 350px; position: relative; padding: 0 16px 8px 16px; box-sizing: border-box;backdrop-filter: brightness(1.25);">

				<button id="menu-modal-data" onclick="showData()">Add/Edit Data</button>

				<label>Chart Options</label>
				<input type="text" onkeyup="newTitle(this)" id="title" style="padding-left: 66px"/>
				<span style="
					position: absolute;
					left: 42px;
					margin-top: 10px;
					font-size: 13px;
					pointer-events: none;
				">Title Text:</span>

				<label>Column Options</label>
				<select onchange="newColumnColor(this)">
					<option value="multi">Color (Default: Multi)</option>
					<option value="redGreen">Red/Green</option>
					<option value="red">Red</option>
					<option value="pink">Pink</option>
					<option value="purple">Purple</option>
					<option value="deeppurple">Deep Purple</option>
					<option value="indigo">Indigo</option>
					<option value="blue">Blue</option>
					<option value="lightblue">Light Blue</option>
					<option value="cyan">Cyan</option>
					<option value="teal">Teal</option>
					<option value="green">Green</option>
					<option value="lightgreen">Light Green</option>
					<option value="lime">Lime</option>
					<option value="yellow">Yellow</option>
					<option value="amber">Amber</option>
					<option value="orange">Orange</option>
					<option value="deeporange">Deep Orange</option>
				</select>
				<select onchange="newLabelPos(this)">
					<option value="none">Label Position (Default: None)</option>
					<option value="inside">Inside</option>
					<option value="outside">Outside</option>
				</select>
				<select onchange="newLabelColor(this)">
					<option value="auto">Label Color (Default: Auto)</option>
					<option value="match">Match Column</option>
					<option value="black">Black</option>
					<option value="white">White</option>
					<option value="red">Red</option>
					<option value="pink">Pink</option>
					<option value="purple">Purple</option>
					<option value="deeppurple">Deep Purple</option>
					<option value="indigo">Indigo</option>
					<option value="blue">Blue</option>
					<option value="lightblue">Light Blue</option>
					<option value="cyan">Cyan</option>
					<option value="teal">Teal</option>
					<option value="green">Green</option>
					<option value="lightgreen">Light Green</option>
					<option value="lime">Lime</option>
					<option value="yellow">Yellow</option>
					<option value="amber">Amber</option>
					<option value="orange">Orange</option>
					<option value="deeporange">Deep Orange</option>
				</select>
				<div class="slider-container">
					<input type="range" value="95" min="1" max="100" onchange="newWidth(this)">
					<span>Column Width</span>
				</div>
				<ul class="ks-cboxtags">
					<li><input type="checkbox" onchange="toggleRounded(this)" id="rounded"><label for="rounded">Rounded</label></li>
					<li><input type="checkbox" onchange="toggleInset(this)" id="inset"><label for="inset">Inset</label></li>
					<li><input type="checkbox" onchange="toggleStriped(this)" id="striped"><label for="striped">Striped</label></li>
					<li><input type="checkbox" onchange="toggleAnimated(this)" id="animated"><label for="animated">Animated</label></li>
				</ul>

				<label>vAxis</label>
				<select onchange="newAxisFormat(this)">
					<option value="number">Label Format (Default: Number)</option>
					<option value="time">Time</option>
					<option value="decimal">Decimal</option>
					<option value="currency" data-symbol="GBP">Currency £</option>
					<option value="currency" data-symbol="USD">Currency $</option>
					<option value="currency" data-symbol="EUR">Currency €</option>
				</select>
				<ul class="ks-cboxtags">
					<li><input type="checkbox" onchange="toggleMajorLines(this)" id="majorLines" checked><label for="majorLines">Major Lines</label></li>
					<li><input type="checkbox" onchange="toggleMinorLines(this)" id="minorLines" checked><label for="minorLines">Minor Lines</label></li>
				</ul>

				<button onclick="htmlToCanvas()">Save</button>

			</div>

		</div>

		<div id="data-input-modal" style="display: none">
			<table>
				<thead>
					<tr>
						<th></th>
						<th>A</th>
						<th>B</th>
					</tr>
				</thead>
				<tbody id="data-input-table">
				</tbody>
			</table>
		</div>

		<div id="canvas-presentation" style="display: none">
			<span>Right click image to save</span>
			<img src="/resources/icons/cross.svg" onclick="closeCanvas()">
		</div>

		<textarea id="options-script" class="full-screen-textbox" style="display: none"></textarea>

		<div id="data-input-overlay" class="overlay" style="display:none"></div>
		<div id="options-script-overlay" class="overlay" style="display:none"></div>

		<div id="column-chart" class="chart-container"></div>

		<script src="crag/crag.charts.loader.js?v=1"></script>
		<script>

			let chart;

			const themeQuery = window.matchMedia('(prefers-color-scheme: dark)');

			themeQuery.addEventListener('change', () => chart.chartColor = cssVar('bg'));

			new CragLoader(['column'], createChart, '/crag/');

			function createChart() {

				const data = dataGenerator(5);
				const options = {
					columns: {
						width: 95,
					},
					vAxis: {
						name: 'A series',
					},
					chart: {
						color: cssVar('bg')
					}
				}

				chart = new CragColumn(data, options).create('column-chart');

			}

		</script>

		<script>

			document.body.oncontextmenu = (event) => {

				if (document.getElementById('canvas-presentation').contains(event.target)) return;

				event.preventDefault();


				if (document.getElementById('menu-modal').contains(event.target)) return;

				document.getElementById('menu-modal').style.display = '';

				document.getElementById('menu-modal').style.left = `${event.clientX}px`;
				document.getElementById('menu-modal').style.top = `${event.clientY}px`;

			}

			function hideMenu() {

				document.getElementById('menu-modal').style.display = 'none';

			}

			function newColumnColor(elem) {

				chart.columnColor = elem.value;

			}

			function newData() {

				document.getElementById('new-data').style.transform = 'rotate(360deg)';
				document.getElementById('new-data').style.pointerEvents = 'none';

				setTimeout(() => document.getElementById('new-data').style.transform = '', 350);
				setTimeout(() => document.getElementById('new-data').style.pointerEvents = '', 800);

				chart.newData = dataGenerator(15);


			}

			function newTitle(elem) {

				chart.title = elem.value;

			}

			function newLabelPos(elem) {

				chart.labelPosition = elem.value;

			}

			function newLabelColor(elem) {

				chart.labelColor = elem.value;

			}

			function newAxisFormat(elem) {

				chart.setAxisFormat(elem.value, elem.options[elem.selectedIndex].dataset.symbol);

			}

			function toggleMajorLines(elem) {

				chart.majorLinesVisible = elem.checked;

			}

			function toggleMinorLines(elem) {

				chart.minorLinesVisible = elem.checked;

			}

			function toggleRounded(elem) {

				chart.columnsRounded = elem.checked;

			}

			function toggleInset(elem) {

				chart.columnsInset = elem.checked;

			}

			function toggleStriped(elem) {

				chart.columnsStriped = elem.checked;

			}

			function toggleAnimated(elem) {

				chart.columnsAnimated = elem.checked;

			}

			function newWidth(elem) {

				chart.columnWidth = Number(elem.value);

			}

			document.getElementById('menu-modal-head').ondragstart = function() {
				return false;
			};

			document.getElementById('menu-modal-head').onmousedown = function(event) {

				const target = event.target;
				target.style.cursor = 'grab';

				let shiftX = event.clientX - document.getElementById('menu-modal').getBoundingClientRect().left;
				let shiftY = event.clientY - document.getElementById('menu-modal').getBoundingClientRect().top;

				// centers the ball at (pageX, pageY) coordinates
				function moveAt(pageX, pageY) {
					document.getElementById('menu-modal').style.left = pageX - shiftX + 'px';
					document.getElementById('menu-modal').style.top = pageY - shiftY + 'px';
				}

				// move our absolutely positioned ball under the pointer
				moveAt(event.pageX, event.pageY);

				function onMouseMove(event) {
					moveAt(event.pageX, event.pageY);
				}

				// (2) move the ball on mousemove
				document.addEventListener('mousemove', onMouseMove);

				// (3) drop the ball, remove unneeded handlers
				document.getElementById('menu-modal').onmouseup = function() {

					target.style.cursor = '';

					document.removeEventListener('mousemove', onMouseMove);
					document.getElementById('menu-modal').onmouseup = null;

				};

			}

			function createOptions() {

				const optionText = "const options = " + JSON.stringify(chart.options, null, 2);

				document.getElementById('options-script-overlay').style.display = '';
				document.getElementById('options-script').style.display = '';

				document.getElementById('options-script').value = optionText;

			}

			function showData() {

				let row = 0;

				for (let r = 0; r < 20; r++) {

					document.getElementById(`data-input-name-${r}`).value = '';
					document.getElementById(`data-input-value-${r}`).value = '';
					document.getElementById(`data-input-name-${r}`).style.background = '';
					document.getElementById(`data-input-value-${r}`).style.background = '';
				}

				for (const d of chart.data.series) {

					document.getElementById(`data-input-name-${row}`).value = d[0];
					document.getElementById(`data-input-value-${row++}`).value = d[1];

				}

				document.getElementById('data-input-overlay').style.display = '';
				document.getElementById('data-input-modal').style.display = '';

			}

			function validateData() {

				const output = [];

				for (let r = 0; r < 20; r++) {

					const name = document.getElementById(`data-input-name-${r}`).value;
					const value = document.getElementById(`data-input-value-${r}`).value;

					if (name === '' && value === '') continue;

					if (name === '') {

						document.getElementById(`data-input-name-${r}`).style.background = 'red';

					} else {

						document.getElementById(`data-input-name-${r}`).style.background = '';

					}

					if (value === '' || isNaN(value)) {

						document.getElementById(`data-input-value-${r}`).style.background = 'red';
						return false;

					} else {

						document.getElementById(`data-input-value-${r}`).style.background = '';

					}

					output.push([name, Number(value)]);

				}

				return output

			}

			document.getElementById('data-input-overlay').onclick = () => {

				const newData = validateData();

				if (newData === false) return;

				chart.newData = newData;

				document.getElementById('data-input-modal').style.display = 'none';
				document.getElementById('data-input-overlay').style.display = 'none';

			}
			document.getElementById('options-script-overlay').onclick = () => {

				document.getElementById('options-script-overlay').style.display = 'none';
				document.getElementById('options-script').style.display = 'none';

			}

			document.body.onload = () => {

				const inputTable = document.getElementById('data-input-table');

				for (let r = 0; r < 20; r++) {

					const row = inputTable.insertRow();

					const name = document.createElement('textarea');
					const value = document.createElement('input');

					name.type = 'text';
					name.id = `data-input-name-${r}`;
					name.onpaste = (event) => {

						setTimeout(() => {

							const newData = name.value.split('\n');

							for (let i = r; i < 20; i++) {

								if (!newData[i] || newData[i] === '') continue;

								const split = newData[i].split('\t');

								if (split[0] === '') continue;
								if (split.length === 1) continue;

								split[1] = parseNumber(split[1]);

								if (isNaN(Number(split[1]))) continue;

								console.log(split);

								document.getElementById(`data-input-name-${i}`).value = split[0];
								document.getElementById(`data-input-value-${i}`).value = Number(split[1]);


							}

						}, 50);

					}

					value.type = 'number';
					value.id = `data-input-value-${r}`;

					name.onfocus = () => name.select();
					value.onfocus = () => value.select();

					row.insertCell().append((r + 1).toString());
					row.insertCell().append(name);
					row.insertCell().append(value);

				}

			}

			function parseNumber(value, locales = navigator.languages) {

				const example = Intl.NumberFormat(locales).format('1.1');
				const cleanPattern = new RegExp(`[^-+0-9${ example.charAt( 1 ) }]`, 'g');
				const cleaned = value.replace(cleanPattern, '');
				const normalized = cleaned.replace(example.charAt(1), '.');

				return parseFloat(normalized);
			}

			function htmlToCanvas() {

				document.body.style.pointerEvents = 'none';

				hideMenu();

				setTimeout(() => {

					html2canvas(document.querySelector("body")).then(canvas => {

						document.querySelector('#canvas-presentation').appendChild(canvas);
						document.querySelector('#canvas-presentation').style.display = '';
						document.body.style.pointerEvents = '';

					});

				}, 50)

			}

			function closeCanvas() {

				document.querySelector('#canvas-presentation').style.display = 'none';

				const children = document.getElementById('canvas-presentation').getElementsByTagName('canvas');

				for (const child of children) child.remove();

			}


		</script>

	</body>

</html>